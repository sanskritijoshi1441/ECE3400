<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Clean Blog - Start Bootstrap Theme</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/clean-blog.min.css" rel="stylesheet">

  </head>

  <body>

    <!-- Navigation -->
   <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand" href="index.html">Intelligent Physical Systems</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="post.html">Labs/Milestones</a>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About the Team</a>
            </li>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <header class="masthead" style="background-image: url('img/lab2.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="post-heading">
              <h1>Lab 2: Analog Circuitry and FFTs</h1>
             </div>
           </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Post Content -->
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
        <h3> Objective</h3>
<p>The objective of the lab is to add sensors to our robot so that it will be able to detect a 660 Hz whistle signifying the beginning of the maze mapping and detect nearby robots and ignore decoy robots.</p>
            
<h3> Acoustic Team </h3>
<h5> Materials </h5>
            &#8226; 1 Arduino Uno <p></p>
            &#8226; 1 Electret Condenser Microphone <p></p>
            &#8226; 1 LM358 Op Amp <p></p>
            &#8226; 2 Caps: 6.8uF, 100nF <p></p>
            &#8226; Resistors: 1 - 330, 1 - 3.8K, 2 - 10K, 1 - 380K Ohms<p></p>
<h5> The Lab </h5>         
              <p> The purpose of this lab was to implement a microphone
              capable of detecting a 660 Hz signal, which would allow 
              our robot to start moving at the beginning of the competition. 
              To do this, we first tested out how the Arduino, with
              support from the FFT library, reacted to a 660 Hz sine wave
              from the function generator- an amplitude of 1.65 Vpp was used with an offect voltage of 825 mV.
              This was confirmed by hooking the output to an oscilloscope, also shown below.</p>
            
<img src = "LabImages/Lab2Images/20180922_103032.jpg" alt="function_generator" class="inline", width="797", height="496">
<img src = "LabImages/Lab2Images/20180922_103204.jpg" alt="osc" class="inline", width="797", height="496">
            
              <p>
              When we plotted the data collected by the Arduino, we saw what we expected: a
              single peak value surrounded by minor noise. After testing
              1320 Hz and 1980 Hz, we saw similar results, which are all
              shown below. </p>            
<img src = "img/FFT1.png" alt="hi" class="inline", width="797", height="496">
            
            <p>We then began implementing the microphone in a circuit
              powered by the Arduino. After testing out the FFT while 
              playing a 660 Hz tone into the microphone, we saw no noticeable
              peaks. We decided that this was because the signal output by
              the microphone was too small relative to the other noise present.
              To remedy this, we added an op amp with a gain of roughly 100
              that output an amplified version of the microphoneâ€™s signal.
              After plotting this data, we noticed the desired peak around
              660 Hz. These results are shown below.</p>
            
<img src = "img/FFT2.png" alt="hi" class="inline", width="797", height="496">
              
            <p>The final schematic of the opamp was drawn up in Eagle. The 
            voltage divider(R1, R2) allowed the op amp Vin+ and Vin- to be
            properly biased, while the resistors(R3,R4) before the 
            negative terminal and between the negative input and 
              the output were responsible for the gain.</p>

<img src = "img/schematic.PNG" alt="hi" class="inline", width="797", height="496">


<h3> Optical Team </h3>
<h3> Materials (Optical)</h3>
            &#8226; 1 Arduino Uno <p></p>
            &#8226; IR Transistor (OP598) <p></p>
            &#8226; 1 IR hat<p></p>
            &#8226; 1 IR decoys<p></p>
            &#8226; LM358 operational amplifier<p></p>
            &#8226; 1 10, 1.8k, 51k Resistor<p></p>
            &#8226; 1 green LED<p></p>
<h3> The Lab </h3>
<p>The goal of the optical portion of the lab is to use the Arduino and FFT library to detect another robot emitting IR at 6.08kHz and to ignore decoys at 18kHz. To do this, we will use a phototransistor to detect the IR on the robots and decoys.  </p>
<p> A phototransistor lets more current pass the more lights it receives, and less current the less light it receives. We will use the setup below to implement the sensor to our circuit.</p>
 <img src = "LabImages/Lab2Images/Phototransistor.png" alt="hi" class="inline">   
 <p>We propped the IR hat onto our robot and connected it to an external 9V power source. We set up the circuit above with the analog pin 0 on the Arduino and ran the FFT to read the signal from the phototransistor. Using the oscilloscope we were able to detect the frequency being emitted from the IR hat. The output of the circuit when we held the phototransistor close to the IR hat is shown below:</p> 
<img src = "LabImages/Lab2Images/Phototransistor output.png" alt="hi" class="inline">
            <p>This is the output of the phototransistor picked up by the oscilloscope:</p>
<img src = "LabImages/Lab2Images/IMG_2715.JPG" alt="hi" class="inline" width="600">
<p>In the graph, we see peaks in bins 40~42 as expected. We know this because we calculated bin width = sampling frequency / # of samples. Sampling frequency is calculated from clock system frequency / division factor / clock = 16MHz / 32 / 13 = ~38kHz. Bin width then becomes 150Hz. 
Knowing this, we would then expect 6.08kHz to reside in bin 40 because bin 40 holds frequencies ranging from 6000 to 6150. However, our oscilloscope was picking up a frequency of 6.2kHz which would explain why our peaks were occuring at bins 41,42. </p>
<p> During the competition, we need to detect the robots at a greater distance, therefore we decided to add a amplifying circuit to our original circuit in order amplify the signal. </p>
<p>Originally, we had planned to create a band width filter in order to ignore lower frequencies caused by outside light and high frequencies caused by the decoy robots, but we were having issues with the op amps and decided to filter through the bins in the fft data. </p>
<p>We created a simple inverting amplifier using the operational amplifier LM358 with Rin value 10 Ohms, and Rf value of 51k Ohms. Rin is in series with the 1.8k Ohm resistor we had originally in series with the phototransistor. </p>
<img src = "LabImages/Lab2Images/invamp.png" alt="hi" class="inline" >
<p>Finally, we connected the amplifier circuit to the circuit with the phototransistor and read the frequencies being emitted from the IR hat and the intensity of the signal.</p>
<p> This is our circuit with the amplifier:</p>
<img src = "LabImages/Lab2Images/IMG_2779.JPG" alt="hi" class="inline" width="600">
<p> This is our output from the phototransistor and amplifier circuit measured at specific distances from the IR hat. We are able to see that our circuit was able to detect a signal from another robot at a reasonable distance.</p>
<img src = "LabImages/Lab2Images/Amplified.JPG" alt="hi" class="inline" >
<p>We added a few lines of code in the fft arduino code to have the Arduino light up an led when it detects another IR hat close by. Our code will check the bins of the frequency we are expecting the phototransistor to detect for an amplitude above a certain threshold, and will perform an action if that threshold frequency has been reached. For this lab, our action was to illuminate a green LED. The video belows shows our Arduino reacting to the presence of a IR hat (Robot):    </p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/5Zfs3fhP4qI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
<p>In the future, our team hopes to implement a high pass filter so that our robot will be able to ignore the lower frequencies emitted from the lights in the room.</p>
          </div>
        </div>
      </div>
    </article>

    <hr>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <ul class="list-inline text-center">
                <li class="list-inline-item">
                <a href="https://github.com/sanskritijoshi1441/ECE3400">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            </ul>
            <p class="copyright text-muted">Copyright &copy; ECE 3400 2018</p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/clean-blog.min.js"></script>

  </body>

</html>
